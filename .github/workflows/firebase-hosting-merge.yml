name: Deploy Multiple Apps to Firebase Hosting

on:
  push:
    branches:
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Setup Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 4. Install Firebase CLI
      - name: Install Firebase CLI
        run: npm install -g firebase-tools

      # 5. Clear npm cache
      - name: Clear npm cache
        run: npm cache clean --force

      # 6. Build Angular Host App
      - name: Build Angular Host App
        run: |
          cd angular-host-app
          npm install --force
          npm run build
          cd ..

      # 7. Build Angular Remote App
      - name: Build Angular Remote App
        run: |
          cd angular-remote-app
          npm install --force
          npm run build
          cd ..

      # 8. Build Vue Host App
      - name: Build Vue Host App
        run: |
          cd vue-host-app
          npm install --force
          npm run build
          cd ..

      # 9. Build Vue Remote App
      - name: Build Vue Remote App
        run: |
          cd vue-remote-app
          npm install --force
          npm run build
          cd ..

      # (Optional) React Host App
      # - name: Build React Host App
      #   run: |
      #       cd react-host-app
      #       npm install --force
      #       SKIP_PREFLIGHT_CHECK=true npm run build
      #       cd ..

      # (Optional) React Remote App
      # - name: Build React Remote App
      #   run: |
      #     cd react-remote-app
      #     npm install --force
      #     SKIP_PREFLIGHT_CHECK=true npm run build
      #     cd ..

      # 10. Deploy Angular Host App
      - name: Deploy Angular Host App
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_ANGULAAR_HOST_APP }}
          channelId: live
          entryPoint: .
          projectId: angulaar-host-app

      # 11. Deploy Angular Remote App
      - name: Deploy Angular Remote App
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_ANGULAAR_HOST_APP }}
          channelId: live
          entryPoint: .
          projectId: angulaar-remote-app

      # 12. Deploy React Host App (optional)
      # - name: Deploy React Host App
      #   uses: FirebaseExtended/action-hosting-deploy@v0
      #   with:
      #     repoToken: ${{ secrets.GITHUB_TOKEN }}
      #     firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_REACT_HOST_APP }}
      #     channelId: live
      #     entryPoint: react-host-app
      #     projectId: react-host-app

      # 13. Deploy React Remote App (optional)
      # - name: Deploy React Remote App
      #   uses: FirebaseExtended/action-hosting-deploy@v0
      #   with:
      #     repoToken: ${{ secrets.GITHUB_TOKEN }}
      #     firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_REACT_REMOTE_APP }}
      #     channelId: live
      #     entryPoint: react-remote-app
      #     projectId: react-remote-app

      # 14. Deploy Vue Host App
      - name: Deploy Vue Host App
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_ANGULAAR_HOST_APP}}
          channelId: live
          entryPoint: .
          projectId: vue-host-app

      # 15. Deploy Vue Remote App
      - name: Deploy Vue Remote App
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FFIREBASE_SERVICE_ACCOUNT_ANGULAAR_HOST_APP }}
          channelId: live
          entryPoint: .
          projectId: vue-remote-app
